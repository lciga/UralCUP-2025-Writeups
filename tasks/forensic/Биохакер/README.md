# Биохакер | hard | forensic

## Информация

> Недавно человеческая наука, в своём безрассудном стремлении прорывать завесу тайн, открыла новую планету — издали она казалась столь же приветливой и живой, как сама Земля. Вслед за открытием была снаряжена экспедиция «Восток-44». Поначалу всё шло согласно протоколам. Но спустя два часа после посадки эфир разорвал голос капитана — его речь дрожала, теряла чёткость, превращаясь в хриплое бормотание:

> «Земля… слышите? Это… <данные засекречены>… Мы… мы ступили на почву, да, посадка совершена… но почвы нет. Всё… всё зелёное, мягкое, оно шевелится, оно тянется к нам, оно дышит. С-салат… о, боже, он везде, он в моих глазах, под кожей… он шепчет… вы слышите? Нет, вы не слышите. От его голоса… не спрятаться, не спрятаться, он ВЕЗДЕ… Они… они кланяются, склонились, они зовут его… Йссалотх… Йссалотх, владыка Зелёной Плоти, пожирающий разум… их голоса — это мой голос… их глаза — мои глаза… Я не… я не могу… земля, простите… простите… но он уже во мне, он во всех нас… и больше нет…»

> И затем — лишь бездонная тишина. Лишь одна последняя передача достигла Земли: нерасшифрованная запись генома и странный код, который, по словам исследователей, должен был открыть ключ к «тайнам божества».


## Выдать участникам

[Файлы](./public/)

## Описание

FASTQ-файл с "геномом" салата из параллельного измерения, где листья хранят послания от овощных богов. Флаг — генетический код "рецепта бессмертия".

## Решение

### Анализ файла
Перед нами FASTQ запись генома, состаящая из одного рида. Можно отметить наличие большого числа A и T, что наталкивает на идею о кодировке. Попробуем декодировать, взяв A=0, T=1:
```python
from Bio import SeqIO
signal_bits = ''
for rec in SeqIO.parse('alien_lettuce.fastq', 'fastq'):
    for base in str(rec.seq):
        if base in ('A', 'T'):
            signal_bits += '0' if base == 'A' else '1'
signal_bits = signal_bits[:len(signal_bits)//8*8]
binary_data = bytes(int(signal_bits[i:i+8], 2) for i in range(0, len(signal_bits), 8))
```
У получившегося бинарного файла имеется сигнатура `50 4B 03 04`, значит это ZIP, архив. Попробуем распаковать. В архиве лежит три PNG и JSON.

### Изучение изображений
Попробуем через stegsolve найти зацепки в изображении. В красном канале можно заметить пиксели, что возможно говорит об LSB-стеганографии, попробуем расшифровать:
```python
from PIL import Image
import numpy as np

img = Image.open('extracted/chlorophyll_map_1.png')
pixels = np.array(img)
red_bits = ''.join(str(p & 1) for p in pixels[:,:,0].ravel())
text = b''
i = 0
while i < len(red_bits):
    byte = red_bits[i:i+8]
    if len(byte) == 8:
        char = int(byte, 2)
        text += bytes([char])
        if char == 0:
            break
    else:
        break
    i += 8
print(text.decode('utf-8'))
```
Расшифровав все изображения получаем подсказки: 
- Листья выстраиваются в космическом порядке.
- Свет прячется в самых зеленых глубинах.
- Поверни спираль, чтобы увидеть вечность.

Подсказки про LSB-стегу и про какую-то спираль, проверим JSON, может быть там что-то будет.

### Построение модели
Изучив JSON не обнаруживаем там ничего похожего на флаг, кроме поля hint, в котором сказано "Салат нашептывает свои секреты в спираль, ищите зеленый свет." наталкивает на стегу. Однако попробуем подставить полученный JSON в скрипт, который, судя по содержимому генерирует модель.

Запустим рендер `blender --background --python lettuce.py` и получим модель с флагом.

## Флаг

`UralCTF{L377uС3_wiLL_74k3_0v3r_7h3_w0RLd_4ND_3n5L4V3_Y0u}`